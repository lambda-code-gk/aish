# セキュリティとプライバシー

`ai` / `aish` はターミナルの入出力やファイル内容を **外部の LLM API**（OpenAI、Google など）に送信します。  
機密情報の誤送信を防ぐため、何が送られ得るかを理解し、必要に応じて leakscan や運用ルールで補強してください。

## 送信され得る情報

- **ユーザーが `ai` に渡したメッセージ（プロンプト）**  
  そのまま API に送られます。
- **セッション履歴**  
  `aish` で記録されたコンソール入出力の一部が、コンテキスト構築時に LLM に送信されます。  
  どの範囲が送られるかは、コンテキスト戦略（要約・絞り込み）に依存します。
- **ツールの結果**  
  エージェントが `read_file` や `run_shell` などを実行した結果が会話に含まれ、続く LLM 呼び出しで送信されます。
- **システムプロンプト（sysq）**  
  `-S` 未指定時、有効な sysq が結合された文字列が system instruction として送られます。

API キーや秘密鍵・トークン・個人情報・社外秘のコードなどが、上記いずれかに含まれないよう注意してください。

## leakscan の利用

`tools/leakscan` は、秘密情報の誤送信を防ぐための検査エンジンです。

- **キーワード・正規表現・Shannon エントロピー** などで、ログやファイルをスキャンします。
- AISH のセッション準備フローに組み込むと、送信前に危険な文字列を検出し、ユーザーに確認や拒否を促すことができます。
- **注意**: leakscan は検出ルールに依存するため、すべての機密を網羅できるわけではありません。あくまで補助として利用し、機微データはそもそもプロンプトやセッションに含めない運用を推奨します。

## 運用上の推奨

- 機密が含まれる可能性のあるログや diff は、`ai` にそのまま渡さない。必要ならマスク・要約してから貼る。
- 重要なリポジトリでは、leakscan を CI や事前チェックに組み込み、人間の確認を挟む。
- API キーは環境変数で渡し、コードやログに書かない。
- 自己責任で利用し、各 LLM プロバイダの利用規約とデータ取り扱いを確認する。

詳細な注意事項は README の Important および `docs/ai-usage.md` のセキュリティの節も参照してください。
