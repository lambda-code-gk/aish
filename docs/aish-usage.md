## aish の基本的な使い方

`aish` は、AISH のセッション管理とログ収集を担うシェルです。  
普段のシェル操作をほぼそのまま行いつつ、「**あとから LLM に相談できるように文脈をためておく**」ための土台になります。

```bash
aish [options] [<command> [args...]]
```

- コマンド省略時: インタラクティブな `aish` シェルを起動します。
- `<command> [args...]` を指定した場合: 非対話モードでそのコマンドだけを実行し、終了します。

### セッションとプロンプト

`aish` を起動すると、プロンプトは概ね次のような形式になります。

```text
(aish:N)$
```

- 先頭の `(aish:...)` が、AISH のシェルであることと、セッションに関する情報を表します。
- `N` はセッションコンテキストのサイズや状態を示す指標です（例: 行数や概算文字数など）。  
  正確な形式は実装に依存しますが、「**セッションがどれくらい蓄積されているか**」の目安として利用できます。

`aish` を起動するたびに、通常は新しいセッションディレクトリが作成されます。

- セッションディレクトリのパス:  
  - **AISH_HOME 指定時**: `$AISH_HOME/state/session/<id>/`
  - **未指定時（XDG）**: `$XDG_STATE_HOME/aish/session/<id>/`（例: `~/.local/state/aish/session/<id>/`）
- `<id>` は日時などから生成される一意な識別子です。

### 典型的な利用フロー

1. `aish` を起動する:

   ```bash
   aish
   (aish:0)$
   ```

2. いつも通りコマンドを実行する:

   ```bash
   (aish:0)$ cargo test
   (テストの出力...)
   (aish:1.2K)$
   ```

3. ログや結果を踏まえて `ai` に相談する:

   ```bash
   (aish:1.2K)$ ai テスト失敗の原因と次に確認すべき点を教えて
   (LLM の応答...)
   (aish:2.0K)$
   ```

4. さらにコマンドを実行しながら対話を続ける。

このように、**開発作業と LLM への問い合わせを同じセッションの中で完結させる**のが基本的な使い方です。

## セッションディレクトリの構造（概要）

セッションディレクトリには、次のような情報が保存されます（実装に依存するため、高レベルな説明にとどめます）。

- コンソール入出力のログ
- `ai` 実行時に送信されたメッセージや応答の一部
- leakscan などによる検査結果
- インデックス情報（高速な検索のためのメタデータ）

これらは、AISH が「どの情報を LLM に送るか」を判断したり、将来的な検索・参照のために利用されます。

> 重要: どの情報が実際に LLM に送信されるかは、`ai` コマンド側のコンテキスト構築ロジックに依存します。  
> 詳細は `ai-usage.md` とセキュリティ関連ドキュメントを参照してください。

## セッションの再開とクリーンアップ

### 既存セッションの再開

`aish` には、既存のセッションディレクトリを指定して再開するオプションがあります。

```bash
aish -s "<session_dir>"   # 例: aish -s "$HOME/.local/state/aish/session/<id>"
```

- `-s, --session-dir` : 再開したいセッションディレクトリを明示します。
- これにより、新しいシェルプロセスが既存のセッションと紐づけられ、`ai` からも同じ履歴を参照できるようになります。

### セッションのクリア

履歴を一度リセットしたい場合は、`clear` サブコマンドを利用します。

```bash
aish clear
```

- セッションディレクトリ内の Part ファイル（会話履歴の断片）を削除し、履歴をクリアします。
- 既存のログを残したまま、新しい会話を始めたい場合に有用です。


## sysq / system.d との関係（概要）

`aish` は、システムプロンプト（sysq）も管理します。

- `aish sysq list` : 利用可能なシステムプロンプトと、有効/無効状態を一覧表示。
- `aish sysq enable <id>` / `disable <id>` : 指定 ID のプロンプトを有効/無効化。

システムプロンプト自体の配置場所や優先順位（`$AISH_HOME/config/system.d`、ユーザー設定、プロジェクトローカル設定など）については、`system-prompts.md` で詳しく説明します。

## まとめ

- `aish` は、**「いつものターミナル作業をセッションとして記録するシェル」** です。
- 各セッションはディレクトリとして保存され、その中のログやメタ情報が `ai` からの LLM 問い合わせに活用されます。
- `-s` オプションや `clear` サブコマンドを使うことで、セッションの再開や管理を柔軟に行えます。

次は `ai-usage.md` を読むことで、「蓄積されたセッションをどう活用して LLM に相談するか」を具体的に理解できます。

